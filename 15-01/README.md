## Домашнее задание к занятию «Введение в виртуализацию» FOPS-38 Щербатых А.Е.

Это задание для самостоятельной отработки навыков и не предполагает обратной связи от преподавателя. Его выполнение не влияет на завершение модуля. Но мы рекомендуем его выполнить, чтобы закрепить полученные знания. Все вопросы, возникающие в процессе выполнения заданий, пишите в раздел "Вопросы по заданиям" в личном кабинете.

**Цели задания** 

Научиться запускать виртуальную машину в Yandex Cloud с минимальным расходом ресурсов.
Попрактиковаться в выборе платформы и системы управления виртуализации для решения требуемых задач.
Инструкция к выполению
Для выполнения задачи 1 ознакомьтесь с инструкцией по экономии облачных ресурсов и затем выполните задачу 1 по шагам.
Своё решение к задачам 2,3,4 загрузите в ваш ЛК.

### Задача 1

Ознакомьтесь с инструкцией по экономии облачных ресурсов.

1. Создайте через web-интерфейс Yandex Cloud - VPC и виртуальную машину из инструкции конфигурации "эконом-ВМ" с публичным ip-адресом. В пункте "Выбор образа/загрузочного диска" выберите вкладку "Cloud Marketplace" , щелкните "Посмотреть больше", найдите образ "Yandex Cloud Toolbox".
2. Убедитесь, что вы можете подключиться к консоли ВМ через ssh, используя публичный ip-адрес. Убедитесь, что на ВМ установлен Docker с помощью команды docker --version(команду выполните от имени root пользователя) !
3. Узнайте в инструкции Яндекс, какие еще инструменты предустановлены в данном образе.
4. Оставьте ВМ работать, пока она не выключится самостоятельно! Опция "прерываемая" выключит ее не позже чем через 24 часа. Для наглядности подождите еще 1 сутки.
5. Перейдите по ссылке . Выберите свой платежный аккаунт. Перейдите на вкладку детализация (фильтр "По продуктам") и оцените график потребления финансов.
6. Удалите ВМ или пользуйтесь ею при выполнении последующих домашних заданий курса обучения.

### Задача 2

Выберите один из вариантов платформы в зависимости от задачи. Здесь нет однозначно верного ответа так как все зависит от конкретных условий: финансирование, компетенции специалистов, удобство использования, надежность, требования ИБ и законодательства, фазы луны.

Тип платформы:

- физические сервера;
- паравиртуализация;
- виртуализация уровня ОС;
  
Задачи:

- высоконагруженная база данных MySql, критичная к отказу;
- различные web-приложения;
- Windows-системы для использования бухгалтерским отделом;
- системы, выполняющие высокопроизводительные расчёты на GPU.
  
Объясните критерии выбора платформы в каждом случае.

### Задача 3

Выберите подходящую систему управления виртуализацией для предложенного сценария. Опишите ваш выбор.

Сценарии:

1. 100 виртуальных машин на базе Linux и Windows, общие задачи, нет особых требований. Преимущественно Windows based-инфраструктура, требуется реализация программных балансировщиков нагрузки, репликации данных и автоматизированного механизма создания резервных копий.
2. Требуется наиболее производительное бесплатное open source-решение для виртуализации небольшой (20-30 серверов) инфраструктуры на базе Linux и Windows виртуальных машин.
3. Необходимо бесплатное, максимально совместимое и производительное решение для виртуализации Windows-инфраструктуры.
4. Необходимо рабочее окружение для тестирования программного продукта на нескольких дистрибутивах Linux.

### Задача 4

Опишите возможные проблемы и недостатки гетерогенной среды виртуализации (использования нескольких систем управления виртуализацией одновременно) и что необходимо сделать для минимизации этих рисков и проблем. Если бы у вас был выбор, создавали бы вы гетерогенную среду или нет?

**Правила приема**
Домашнее задание выполните в файле readme.md в GitHub-репозитории. В личном кабинете отправьте на проверку ссылку на .md-файл в вашем репозитории.

### Решение

### Задание 1



### Задание 2

Отличный вопрос! Выбор платформы действительно зависит от компромисса между производительностью, управляемостью, безопасностью и стоимостью. Давайте разберем каждый случай, опираясь на ключевые критерии.

Вот сводная таблица с рекомендуемыми платформами и основными аргументами для каждого сценария:

| Задача | Рекомендуемая платформа | Ключевые критерии выбора | Альтернативы и нюансы |
| :--- | :--- | :--- | :--- |
| **Высоконагруженная БД MySQL** | **Физические сервера** (Bare Metal) | **Производительность** (минимальные задержки I/O), **надежность** (полный контроль над железом), **предсказуемость**. | **Паравиртуализация** (VMware, KVM) с PCIe Passthrough для дисков — если критична **масштабируемость/миграция**. |
| **Различные web-приложения** | **Виртуализация уровня ОС** (Docker + Kubernetes) | **Плотность** и **эффективность**, **скорость развертывания**, **переносимость**, **микросервисная архитектура**. | **Паравиртуализация** — для **монолитных** приложений или при отсутствии экспертизы по контейнерам. |
| **Windows для бухгалтерии** | **Паравиртуализация** (VMware, Hyper-V) | **Изоляция** и **безопасность**, **управляемость** (снапшоты, бэкапы), **совместимость** с лицензированием Windows. | Для **высокопроизводительных** рабочих станций — **VDI** на базе паравиртуализации. |
| **Высокопроизводительные расчёты на GPU** | **Физические сервера** или **специализированные облака** (AWS EC2 P3, GCP A2) | **Прямой доступ к железу** (особенно GPU, NVLink), **производительность сети** (InfiniBand), **стоимость** при постоянной загрузке. | **Паравиртуализация** с **GPU Passthrough/SR-IOV** — для разделения дорогой карты между несколькими задачами. |

---

### Подробное обоснование по каждому случаю

#### 1. Высоконагруженная база данных MySQL, критичная к отказу
*   **Ключевые критерии**: Производительность дискового ввода-вывода (I/O) и оперативной памяти, минимальная задержка (latency), полный контроль над ресурсами.
*   **Почему физические сервера**: Гипервизор добавляет overhead (накладные расходы) на доступ к дискам и памяти, что для высоких нагрузок критично. Прямой доступ к NVMe-дискам и настройка RAID-контроллера дают максимальную скорость и предсказуемость. Для отказоустойчивости строится кластер поверх физических серверов (например, на основе репликации MySQL Galera или Percona XtraDB Cluster).
*   **Альтернатива**: Если требования к масштабируемости и миграции выше, чем к предельной производительности, можно использовать **паравиртуализацию**. Но тогда для СУБД нужно выделять отдельные физические диски с технологией PCIe Passthrough (сквозной доступ), чтобы виртуальная машина работала с ними напрямую, минуя виртуальное хранилище гипервизора.

#### 2. Различные web-приложения
*   **Ключевые критерии**: Эффективность использования ресурсов, скорость развертывания и масштабирования, изоляция зависимостей, простое управление множеством сред (dev, test, prod).
*   **Почему виртуализация уровня ОС (контейнеры)**: Контейнеры (Docker) обеспечивают легковесную изоляцию, запускаясь в долю секунды и потребляя минимум ресурсов по сравнению с полноценной виртуальной машиной. Оркестратор (Kubernetes) решает задачи масштабирования, балансировки нагрузки и отказоустойчивости идеально для stateless (без сохранения состояния) веб-приложений. Это стандарт де-факто для микросервисной архитектуры.
*   **Альтернатива**: Для **монолитных** или **legacy-приложений**, которые сложно или не нужно контейнеризировать, лучше подойдет классическая **паравиртуализация**. Она дает полную изоляцию и привычную модель управления.

#### 3. Windows-системы для бухгалтерского отдела
*   **Ключевые критерии**: Надёжная изоляция (одна сбойная система не должна влиять на другие), простота резервного копирования и восстановления, совместимость с лицензированием Microsoft, централизованное управление.
*   **Почему паравиртуализация**: Полноценные виртуальные машины с Windows — это стандартный и хорошо управляемый подход. Гипервизор (особенно **Hyper-V** от Microsoft) обеспечивает отличную интеграцию, поддержку снапшотов для быстрого отката, лёгкое перемещение ВМ между хостами (Live Migration). Это соответствует корпоративным стандартам и лицензионным соглашениям Microsoft.
*   **Альтернатива**: Для задач, требующих графического интерфейса высокой чёткости (например, работа с 1С), может использоваться технология **VDI (Virtual Desktop Infrastructure)** — по сути, те же виртуальные машины, но с оптимизированной передачей графики на тонкие клиенты.

#### 4. Системы для высокопроизводительных расчётов на GPU
*   **Ключевые критерии**: **Максимальная и эксклюзивная производительность** GPU, минимальные задержки при доступе к видеопамяти и между GPU (через NVLink), высочайшая скорость сети (InfiniBand).
*   **Почему физические сервера (или специализированный облачный инстанс)**: Любая виртуализация вносит задержки при доступе к GPU, что сводит на нет преимущества дорогого оборудования для задач ML, рендеринга или вычислений. Прямой доступ (Bare Metal) гарантирует, что вся мощь карты (наподобие NVIDIA A100/H100) используется на 100%. При постоянной загрузке собственные сервера часто выгоднее облачных.
*   **Альтернатива**: Если нужно **разделить** одну мощную GPU между несколькими менее требовательными задачами или пользователями, используют **паравиртуализацию с технологией GPU Passthrough** (сквозной доступ) или **SR-IOV** (создание виртуальных функций GPU). Это сложнее в настройке, но повышает утилизацию дорогого оборудования.

### Универсальный совет
На практике чаще всего используется **комбинированный подход (гибридная инфраструктура)**:
*   **Ядро** (БД, GPU-кластер) работает на **физических серверах**.
*   **Фронтенд и микросервисы** работают в **контейнерах** на оркестраторе.
*   **Корпоративные и legacy-системы** (включая Windows) живут на **виртуальных машинах**.

Это позволяет выбрать оптимальный инструмент для каждой задачи, балансируя между производительностью, гибкостью и стоимостью.



